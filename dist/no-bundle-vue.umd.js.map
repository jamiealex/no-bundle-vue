{"version":3,"file":"no-bundle-vue.umd.js","sources":["../src/init.ts","../src/compile.ts","../src/index.ts","../src/snowpack.ts","../src/end.ts"],"sourcesContent":["import rimraf from 'rimraf';\nimport util from 'util';\nimport glob from 'glob';\nimport path from 'path';\n\nconst rimrafPromise = util.promisify(rimraf);\n\nexport function getAbsolutePath (directory: string): string {\n  return path.resolve(__dirname, directory);\n}\n\nexport async function cleanDirectory (directory: string): Promise<void> {\n    return rimrafPromise(directory);\n}\n\nexport function getSourceFiles(directory: string): string[] {\n  return glob.sync(path.resolve(directory, './**/*.?(js|vue)'));\n}\n","import * as Rollup from 'rollup';\nimport vue from 'rollup-plugin-vue';\n\nexport async function compileSourceFile(sourceFile: string, sourceDirectory: string, outputDirectory: string): Promise<void> {\n  let importStatements: string[];\n  const rolledVueFile = await Rollup.rollup({\n    input: sourceFile,\n    plugins: [\n      {\n        name: 'HoistImportsPlugin',\n        resolveId(source) {\n          if (source !== sourceFile && !source.match(/\\?rollup-plugin-vue=script.js$/)) {\n            return {id: source, external: true};\n          }\n          return null;\n        },\n        transform(source, importer) {\n          if (!importer.match(/\\?rollup-plugin-vue=script.js/)) {\n            let transformedSource:string = source\n            importStatements = [...getImportStatements(source)]\n            for (const importStatement of importStatements) {\n              transformedSource = transformedSource.replace(importStatement, '')\n            }\n            return transformedSource\n          }\n        },\n        intro () {\n          return importStatements.map(str => str.replace('.vue', '.js')).join('\\n');\n        }\n      },\n      vue(),\n      {\n        name: 'TransformImport',\n        renderChunk (code) {\n          const transformedCode = code.replace(/vue-runtime-helpers\\/(.*)\\.mjs/g, `/web_modules/vue-runtime-helpers/$1.js`)\n          return transformedCode\n        }\n      }\n    ],\n    external: ['vue']\n  });\n\n  const outputName = sourceFile\n    .replace(sourceDirectory, outputDirectory)\n    .replace(/(vue)$/, 'js');\n\n  rolledVueFile.write({\n    file: outputName,\n    format: 'esm',\n    // sourcemap: true,\n  });\n}\n\nconst IMPORT_REGEXP = /^\\s*import\\s(?!type(of\\s|\\s)(?!from)).*\\sfrom\\s['\"](.*)['\"].*$/gm;\n\nfunction* getImportStatements(code: string): IterableIterator<string> {\n  while (true) {\n    const match = IMPORT_REGEXP.exec(code);\n    if (match === null) {\n      break;\n    }\n    yield match[0];\n  };\n}\n","\nimport { getAbsolutePath, cleanDirectory, getSourceFiles } from './init';\nimport { compileSourceFile } from './compile';\nimport { snowpack } from './snowpack';\nimport { moveIndex } from './end';\n\ntype NoBundleVueOptions = {\n  sourceDirectory: string;\n  outputDirectory: string;\n};\n\nexport default async function noBundleVue({\n  sourceDirectory,\n  outputDirectory,\n}: NoBundleVueOptions): Promise<void> {\n  const absoluteSourceDirectory = getAbsolutePath(sourceDirectory);\n  const absoluteOutputDirectory = getAbsolutePath(outputDirectory);\n\n  await cleanDirectory(absoluteOutputDirectory);\n\n  for (const sourceFile of getSourceFiles(absoluteSourceDirectory)) {\n    await compileSourceFile(sourceFile, absoluteSourceDirectory, absoluteOutputDirectory);\n  }\n\n  await snowpack(absoluteSourceDirectory, absoluteOutputDirectory);\n  await moveIndex(absoluteSourceDirectory, absoluteOutputDirectory);\n}\n","import path from 'path';\nimport { spawn } from 'child_process';\n\nexport async function snowpack(sourceDirectory: string, outputDirectory: string): Promise<void> {\n  const snowpackLocation = path.resolve(\n    require.resolve('snowpack'),\n    '../index.bin.js'\n  );\n\n  await new Promise((resolve, reject) => {\n    const proc = spawn(\n      'node',\n      [\n        snowpackLocation,\n        '--include',\n        path.resolve(outputDirectory, './**/*.js'),\n        '--dest',\n        path.resolve(outputDirectory, './web_modules'),\n      ],\n      {\n        // Super opinionated. Need to find the nearest node_modules folder for this\n        cwd: path.resolve(sourceDirectory, '../'),\n        stdio: 'inherit',\n      }\n    );\n    proc.on('exit', (code: number) => {\n      if (code > 0) return reject();\n      resolve();\n    });\n  });\n}\n","import fs from 'fs';\nimport path from 'path';\n\nexport async function moveIndex(sourceDirectory: string, outputDirectory: string): Promise<void> {\n  return fs.promises.copyFile(\n    path.resolve(sourceDirectory, './index.html'),\n    path.resolve(outputDirectory, './index.html')\n  );\n}\n"],"names":["rimrafPromise","util","promisify","rimraf","getAbsolutePath","directory","path","resolve","__dirname","compileSourceFile","sourceFile","sourceDirectory","outputDirectory","importStatements","rolledVueFile","Rollup","input","plugins","name","resolveId","source","match","id","external","transform","importer","transformedSource","importStatement","getImportStatements","replace","intro","map","str","join","vue","renderChunk","code","outputName","write","file","format","IMPORT_REGEXP","exec","absoluteSourceDirectory","absoluteOutputDirectory","cleanDirectory","glob","sync","snowpackLocation","require","Promise","reject","spawn","cwd","stdio","on","snowpack","fs","promises","copyFile","moveIndex"],"mappings":"+3BAKA,IAAMA,EAAgBC,EAAKC,UAAUC,YAErBC,EAAiBC,GAC/B,OAAOC,EAAKC,QAAQC,UAAWH,kBCLXI,EAAkBC,EAAoBC,EAAyBC,GACnF,IAAIC,EACEC,QAAsBC,SAAc,CACxCC,MAAON,EACPO,QAAS,CACP,CACEC,KAAM,qBACNC,UAAUC,GACJA,IAAWV,GAAeU,EAAOC,MAAM,uCAClC,CAACC,GAAIF,EAAQG,UAAU,GAIlCC,UAAUJ,EAAQK,GAChB,IAAKA,EAASJ,MAAM,iCAAkC,CACpD,IAAIK,EAA2BN,EAE/B,IAAK,IAAMO,KADXd,EAAmB,IAAIe,EAAoBR,IAEzCM,EAAoBA,EAAkBG,QAAQF,EAAiB,IAEjE,OAAOD,IAGXI,MAAK,IACIjB,EAAiBkB,IAAIC,GAAOA,EAAIH,QAAQ,OAAQ,QAAQI,KAAK,OAGxEC,IACA,CACEhB,KAAM,kBACNiB,YAAaC,GACaA,EAAKP,QAAQ,8EAK3CN,SAAU,CAAC,SAGPc,EAAa3B,EAChBmB,QAAQlB,EAAiBC,GACzBiB,QAAQ,SAAU,MAErBf,EAAcwB,MAAM,CAClBC,KAAMF,EACNG,OAAQ,QAKZ,IAAMC,EAAgB,mEAEtB,SAAUb,EAAoBQ,GAC5B,OAAa,CACX,IAAMf,EAAQoB,EAAcC,KAAKN,GACjC,GAAc,OAAVf,EACF,YAEIA,EAAM,iCClD0BV,gBACxCA,EADwCC,gBAExCA,KAEM+B,EAA0BvC,EAAgBO,GAC1CiC,EAA0BxC,EAAgBQ,GAIhD,IAAK,IAAMF,0BFTyBL,GAClC,OAAOL,EAAcK,GEMjBwC,CAAeD,GFFdE,EAAKC,KAAKzC,EAAKC,QEIkBoC,EFJC,4BEKjClC,EAAkBC,EAAYiC,EAAyBC,wBClBlCjC,EAAyBC,GACtD,IAAMoC,EAAmB1C,EAAKC,QAC5B0C,QAAQ1C,QAAQ,YAChB,6BAGQ2C,QAAQ,CAAC3C,EAAS4C,KACbC,QACX,OACA,CACEJ,EACA,YACA1C,EAAKC,QAAQK,EAAiB,aAC9B,SACAN,EAAKC,QAAQK,EAAiB,kBAEhC,CAEEyC,IAAK/C,EAAKC,QAAQI,EAAiB,OACnC2C,MAAO,YAGNC,GAAG,OAASnB,IACf,GAAIA,EAAO,EAAG,OAAOe,IACrB5C,QDHEiD,CAASb,EAAyBC,wBErBVjC,EAAyBC,GACvD,OAAO6C,EAAGC,SAASC,SACjBrD,EAAKC,QAAQI,EAAiB,gBAC9BL,EAAKC,QAAQK,EAAiB,iBFmB1BgD,CAAUjB,EAAyBC"}